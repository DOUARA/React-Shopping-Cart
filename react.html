<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title> Simple Shoping Cart With Bulma Framework</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    
    <script src="https://use.fontawesome.com/374316767a.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div class="container">
        <header class="columns header">
            <div class="column logo-text">
                <h1> Shopping Cart Experience  </h1>
            </div> <!-- logo -->

            <div class="column user-info">
                <img src="images/profile.jpg" alt="profile pic">
                <div class="dropdown is-hoverable">
                    <div class="dropdown-trigger">
                        Logged in as
                        <span aria-haspopup="true" aria-controls="dropdown-menu4">
                        <span class="username"> thislooksgreat</span>
                            <span class="icon is-small">
                                <i class="fa fa-angle-down" aria-hidden="true"></i>
                            </span>
                        </span>
                    </div>
                    <div class="dropdown-menu" id="dropdown-menu4" role="menu">
                        <div class="dropdown-content">
                            <a class="dropdown-item">
                               Logout
                            </a>
                        </div>
                </div>
            </div> <!-- user info -->
        </header> <!-- header -->

        <section class="section products-table">
            <div class="columns table-header">
                <div class="column">
                    Image
                </div>
                <div class="column is-half">
                    Product Description
                </div>
                <div class="column">
                    Quantity
                </div>
                <div class="column">
                    Price
                </div>
                <div class="column">
                    Total
                </div>
            </div> <!-- table heading -->
            <div id="shopping_cart">
                <!-- Shopping Cart Componenet Goes here :) -->
            </div>
        </section>
            
        
    </div> <!-- container -->

    <footer class="footer">
        www.thislooksgreat.net
    </footer>

    <!-- React Script -->
    <script type="text/babel">
        /* Products Data */
        const products = [
                {
                    image: "images/rose.jpg", 
                    description: "Box of 12 Rose Petal Blueberry Cupcakes", 
                    code: "TLG12345", quantity:"2",  price:"12.99" 
                },

                {
                    image: "images/cookie.jpg", 
                    description: "Box of 6 cookies monster raspberry Cupcakes", 
                    code: "CHRIS99", quantity:"1",  price:"8.99"
                }
        ];

        /* Defining Components 
        /* Product row stateless componenets */

        const ProductImage = (props) => 
                    <div className="column product-image">
                        <img src={props.url} alt={props.imageAlt} />
                    </div>;

        const ProductDescription = (props) => 
                    <div className="column is-half product-title">
                        <h1>{props.description}</h1>
                        <h2>Product code:  {props.code}</h2>
                    </div>; 

        const ProductQuantity = (props) => 
                    <div className="column center-container">
                        <span className="mobile-table-heading"> Quantity</span>
                        <input id={props.id} className="quantity" type="number" name="quantity" min="1" max="100" defaultValue={props.quantity} 
                        onChange={props.changeQuantity} />
                    </div>;

        const ProductPrice = (props) => 
                    <div className="column center-container">
                        <span className="mobile-table-heading"> Price</span> ${props.price}
                    </div>;
            

        const ProductTotalCost = (props) => 
                    <div className="column center-container">
                        <span className="mobile-table-heading"> Total</span> ${props.totalCost}
                    </div>;


        const Product = (props) => 
                    <div className="columns product-row">
                        <ProductImage url={props.image} />
                        <ProductDescription description={props.description} code={props.code} />
                        <ProductQuantity id={props.code} changeQuantity={props.changeQuantity} quantity={props.quantity} />
                        <ProductPrice price={props.price} />
                        <ProductTotalCost totalCost={props.totalCost} />
                    </div>;

        const Disaccount = (props) => 
                    <div className = "column discount">
                        <h1> Discount Code or Voucher  </h1>
                        <p>
                            Enter your Discount code or voucher to recieve a discount on your total order.
                            Multiple vouchers cannot be applied. 
                        </p>
                        <div className = "field has-addons">
                            <div className = "control">
                                <input className = "input" type="text" />
                            </div>
                            <div className = "control">
                                <a className = "button is-link">
                                    Redeem
                                </a>
                            </div>
                        </div>
                    </div>;
        
        const TotalCost = (props) => <span className="total">Total ${props.total} </span>;

        const CheckoutForm = (props) => 
                <div className="column submit-form">
                            <div id="total">
                                <TotalCost total ={props.total} />    
                            </div>
                            <div className="field is-grouped">
                                    <p className="control">
                                        <a className="button is-dark">
                                            Back to shop
                                        </a>                                        
                                    </p>
                                    <p className="control">
                                        <a className="button is-link">
                                            Continue to checkout
                                        </a>
                                    </p>
                            </div>
                </div>;
       
        class ShoppingCart extends React.Component {
            constructor(props, context) {
                super(props, context);
                this.state = {
                    productComponents: [] // An array to hold all the products
                };
                // Pushing all products to state.productComponents
                let total = 0; // Used to calculate the total cost 
                for(let product of products) {
                    this.state.productComponents.push(<Product key={product.code} image={product.image} description={product.description} 
                    code={product.code} changeQuantity={this.changeQuantity} totalCost={product.quantity * product.price} quantity={product.quantity} price={product.price} />);
                    total += Number(product.quantity) * Number(product.price);
                }

                this.state.total = total;
            }

            // this function get executed when changing the quantity of a product 
            changeQuantity = (e) => {

                let newState;
                
                for(let i = 0; i < this.state.productComponents.length; i++) {
                    
                    if (this.state.productComponents[i].props.code == e.target.id) {
                        // Clone the current productComponents state
                        newState = this.state.productComponents.slice(); 
                        
                        // Getting the old total cost
                        let oldTotalCost = newState[i].props.totalCost;
                       
                        // Setting the new total Cost
                        let newProps = Object.assign({}, newState[i].props);
                        newProps.totalCost = (e.target.value * newState[i].props.price).toFixed(2);
                        
                        let product = Object.assign({}, newState[i]);
                        product.props = newProps;

                        newState[i] = product;

                        this.setState( (prevState, props) => ({
                            productComponents: newState,
                            total: (Number(prevState.total) + Number(newProps.totalCost) - Number(oldTotalCost)).toFixed(2) 
                        }));     
                    } 
                }
                e.preventDefault(); 
            }

            
            render() {    
                return(
                    <div>                     
                        {this.state.productComponents}
                        <section className="columns checkout">
                            <Disaccount />
                            <CheckoutForm total={this.state.total}/>
                        </section>
                    </div>
                );
            }
        }


/* Rendering */ 
const shoppingCart = document.getElementById("shopping_cart");
    ReactDOM.render(
        <React.Fragment>
            <ShoppingCart />
        </React.Fragment>
        , 
        shoppingCart
    );
</script>

</body>
</html>